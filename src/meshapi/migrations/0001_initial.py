# Generated by Django 4.2.10 on 2024-03-16 03:08

import django.contrib.postgres.fields
import django.core.validators
import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    initial = True

    dependencies = []

    operations = [
        migrations.CreateModel(
            name="Building",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "bin",
                    models.IntegerField(
                        blank=True,
                        help_text="NYC DOB Identifier for the structure containing this building",
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "street_address",
                    models.CharField(
                        blank=True,
                        help_text="Line 1 only of the address of this building: i.e. <house num> <street>",
                        null=True,
                    ),
                ),
                (
                    "city",
                    models.CharField(
                        blank=True,
                        help_text='The name of the borough this building is in for buildings within NYC, "New York" for Manhattan to match street addresses. The actual city name for anything outside NYC',
                        null=True,
                    ),
                ),
                (
                    "state",
                    models.CharField(
                        blank=True,
                        help_text='The 2 letter abreviation of the US State this building is contained within, e.g. "NY" or "NJ"',
                        null=True,
                    ),
                ),
                (
                    "zip_code",
                    models.CharField(
                        blank=True, help_text="The five digit ZIP code this building is contained within", null=True
                    ),
                ),
                (
                    "address_truth_sources",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(
                            choices=[
                                ("OSMNominatim", "OSMNominatim"),
                                ("OSMNominatimZIPOnly", "OSMNominatimZIPOnly"),
                                ("NYCPlanningLabs", "NYCPlanningLabs"),
                                ("PeliasStringParsing", "PeliasStringParsing"),
                                ("ReverseGeocodeFromCoordinates", "ReverseGeocodeFromCoordinates"),
                            ]
                        ),
                        help_text="A list of strings that answers the question: How did we determine the content of the street address, city, state, and ZIP fields? This is useful in understanding the level of validation applied to spreadsheet imported data. Possible values are: OSMNominatim, OSMNominatimZIPOnly, NYCPlanningLabs, PeliasStringParsing, ReverseGeocodeFromCoordinates. Check the import script for details",
                        size=None,
                    ),
                ),
                ("latitude", models.FloatField(help_text="Building latitude in decimal degrees")),
                ("longitude", models.FloatField(help_text="Building longitude in decimal degrees")),
                (
                    "altitude",
                    models.FloatField(
                        blank=True,
                        help_text='Building rooftop altitude in "absolute" meters above mean sea level',
                        null=True,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        help_text="A free-form text description of this building, to track any additional information. For Buidings imported from the spreadsheet, this starts with a formatted block of information about the import processand original spreadsheet data. However this structure can be changed by admins at any time and should not be relied onby automated systems. ",
                        null=True,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Device",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "name",
                    models.CharField(
                        blank=True,
                        default=None,
                        help_text="The colloquial name of this node used among mesh volunteers, if applicable",
                        null=True,
                    ),
                ),
                (
                    "model",
                    models.CharField(help_text="The manufacturer model name of this device, e.g. OmniTik or LBEGen2"),
                ),
                (
                    "type",
                    models.CharField(
                        choices=[
                            ("ap", "Ap"),
                            ("gateway", "Gateway"),
                            ("gpon", "Gpon"),
                            ("convertor", "Convertor"),
                            ("other", "Other"),
                            ("ptp", "Ptp"),
                            ("router", "Router"),
                            ("server", "Server"),
                            ("station", "Station"),
                            ("switch", "Switch"),
                            ("ups", "Ups"),
                            ("wireless", "Wireless"),
                            ("homeWiFi", "Homewifi"),
                            ("wirelessDevice", "Wirelessdevice"),
                        ],
                        help_text="The general type of device that this is, the role it fills on the mesh. e.g. ap, ptp, station, etc. This lines up with the UISP 'role' property",
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[("Inactive", "Inactive"), ("Active", "Active"), ("Potential", "Potential")],
                        help_text="The current status of this device",
                    ),
                ),
                (
                    "latitude",
                    models.FloatField(
                        help_text="Approximate Device latitude in decimal degrees (this will match the attached Node object in most cases, but has been manually moved around in some cases to more accurately reflect the device location)"
                    ),
                ),
                (
                    "longitude",
                    models.FloatField(
                        help_text="Approximate Device longitude in decimal degrees (this will match the attached Node object in most cases, but has been manually moved around in some cases to more accurately reflect the device location)"
                    ),
                ),
                (
                    "altitude",
                    models.FloatField(
                        blank=True,
                        help_text='Approximate Device altitude in "absolute" meters above mean sea level (this will match the attached Node object in most cases, but has been manually moved around in some cases to more accurately reflect the device location)',
                        null=True,
                    ),
                ),
                (
                    "install_date",
                    models.DateField(
                        blank=True,
                        default=None,
                        help_text="The date this device first became active on the mesh",
                        null=True,
                    ),
                ),
                (
                    "abandon_date",
                    models.DateField(
                        blank=True,
                        default=None,
                        help_text="The this device was abandoned, unplugged, or removed from service",
                        null=True,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        default=None,
                        help_text="A free-form text description of this Device, to track any additional information. For imported Devices, this starts with a formatted block of information about the import processand original data. However this structure can be changed by admins at any time and should not be relied onby automated systems. ",
                        null=True,
                    ),
                ),
                (
                    "uisp_id",
                    models.CharField(
                        blank=True,
                        default=None,
                        help_text="The UUID used to indentify this device in UISP (if applicable)",
                        null=True,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Member",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("name", models.CharField(help_text='Member full name in the format: "First Last"')),
                (
                    "primary_email_address",
                    models.EmailField(
                        help_text="Primary email address used to contact the member", max_length=254, null=True
                    ),
                ),
                (
                    "stripe_email_address",
                    models.EmailField(
                        blank=True,
                        default=None,
                        help_text="Email address used by the member to donate via Stripe, if different to their primary email",
                        max_length=254,
                        null=True,
                    ),
                ),
                (
                    "additional_email_addresses",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.EmailField(max_length=254),
                        blank=True,
                        default=list,
                        help_text="Any additional email addresses associated with this member",
                        null=True,
                        size=None,
                    ),
                ),
                (
                    "phone_number",
                    models.CharField(
                        blank=True, default=None, help_text="A contact phone number for this member", null=True
                    ),
                ),
                (
                    "slack_handle",
                    models.CharField(blank=True, default=None, help_text="The member's slack handle", null=True),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        default=None,
                        help_text="A free-form text description of how to contact this member, to track any additional information. For Members imported from the spreadsheet, this starts with a formatted block of information about the import processand original spreadsheet data. However this structure can be changed by admins at any time and should not be relied onby automated systems. ",
                        null=True,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Node",
            fields=[
                (
                    "network_number",
                    models.AutoField(
                        db_column="network_number",
                        primary_key=True,
                        serialize=False,
                        validators=[django.core.validators.MaxValueValidator(8192)],
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        blank=True,
                        default=None,
                        help_text="The colloquial name of this node used among mesh volunteers, if applicable",
                        null=True,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[("Inactive", "Inactive"), ("Active", "Active"), ("Planned", "Planned")],
                        help_text="The current status of this Node",
                    ),
                ),
                (
                    "latitude",
                    models.FloatField(
                        help_text="Approximate Node latitude in decimal degrees (this will match one of the attached Building objects in most cases, but has been manually moved around in some cases to more accurately reflect node location)"
                    ),
                ),
                (
                    "longitude",
                    models.FloatField(
                        help_text="Approximate Node longitude in decimal degrees (this will match one of the attached Building objects in most cases, but has been manually moved around in some cases to more accurately reflect node location)"
                    ),
                ),
                (
                    "altitude",
                    models.FloatField(
                        blank=True,
                        help_text='Approximate Node altitude in "absolute" meters above mean sea level (this will match one of the attached Building objects in most cases, but has been manually moved around in some cases to more accurately reflect node location)',
                        null=True,
                    ),
                ),
                (
                    "install_date",
                    models.DateField(
                        blank=True,
                        default=None,
                        help_text="The date the first Install or Device associated with this Node became active on the mesh",
                        null=True,
                    ),
                ),
                (
                    "abandon_date",
                    models.DateField(
                        blank=True,
                        default=None,
                        help_text="The date the last Install or Device associated with this Node was abandoned, unplugged, or removed from service",
                        null=True,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        help_text="A free-form text description of this Node, to track any additional information. For Nodes imported from the spreadsheet, this starts with a formatted block of information about the import processand original spreadsheet data. However this structure can be changed by admins at any time and should not be relied onby automated systems. ",
                        null=True,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Sector",
            fields=[
                (
                    "device_ptr",
                    models.OneToOneField(
                        auto_created=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        parent_link=True,
                        primary_key=True,
                        serialize=False,
                        to="meshapi.device",
                    ),
                ),
                (
                    "radius",
                    models.FloatField(
                        help_text="The radius to display this sector on the map (in km)",
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "azimuth",
                    models.IntegerField(
                        help_text="The compass heading that this sector is pointed towards",
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(360),
                        ],
                    ),
                ),
                (
                    "width",
                    models.IntegerField(
                        help_text="The approximate width of the beam this sector produces",
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(360),
                        ],
                    ),
                ),
                (
                    "ssid",
                    models.CharField(
                        blank=True, default=None, help_text="The SSID being broadcast by this device", null=True
                    ),
                ),
            ],
            bases=("meshapi.device",),
        ),
        migrations.CreateModel(
            name="Link",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "status",
                    models.CharField(
                        choices=[("Inactive", "Inactive"), ("Planned", "Planned"), ("Active", "Active")],
                        help_text="The current status of this link",
                    ),
                ),
                (
                    "type",
                    models.CharField(
                        blank=True,
                        choices=[("Standard", "Standard"), ("VPN", "Vpn"), ("MMWave", "Mmwave"), ("Fiber", "Fiber")],
                        default=None,
                        help_text="The technology used for this link 5Ghz, 60Ghz, fiber, etc.",
                        null=True,
                    ),
                ),
                (
                    "install_date",
                    models.DateField(blank=True, default=None, help_text="The date this link was created", null=True),
                ),
                (
                    "abandon_date",
                    models.DateField(
                        blank=True,
                        default=None,
                        help_text="The date this link was powered off, disassembled, or abandoned",
                        null=True,
                    ),
                ),
                (
                    "description",
                    models.CharField(
                        blank=True,
                        default=None,
                        help_text='A short description of "where to where" this link connects in human readable language',
                        null=True,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        default=None,
                        help_text="A free-form text description of this Link, to track any additional information.",
                        null=True,
                    ),
                ),
                (
                    "uisp_id",
                    models.CharField(
                        blank=True,
                        default=None,
                        help_text="The UUID used to indentify this link in UISP (if applicable)",
                        null=True,
                    ),
                ),
                (
                    "from_device",
                    models.ForeignKey(
                        help_text="The device on one side of this network link, from/to are not meaningful except to disambiguate",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="links_from",
                        to="meshapi.device",
                    ),
                ),
                (
                    "to_device",
                    models.ForeignKey(
                        help_text="The device on one side of this network link, from/to are not meaningful except to disambiguate",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="links_to",
                        to="meshapi.device",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Install",
            fields=[
                ("install_number", models.AutoField(db_column="install_number", primary_key=True, serialize=False)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("Request Received", "Request Received"),
                            ("Pending", "Pending"),
                            ("Blocked", "Blocked"),
                            ("Active", "Active"),
                            ("Inactive", "Inactive"),
                            ("Closed", "Closed"),
                            ("NN Reassigned", "Nn Reassigned"),
                        ],
                        help_text="The current status of this install",
                    ),
                ),
                (
                    "ticket_id",
                    models.IntegerField(
                        blank=True,
                        help_text="The ID of the OSTicket used to track communications with the member about this install",
                        null=True,
                    ),
                ),
                ("request_date", models.DateField(help_text="The date that this install request was received")),
                (
                    "install_date",
                    models.DateField(
                        blank=True,
                        default=None,
                        help_text="The date this install was completed and deployed to the mesh",
                        null=True,
                    ),
                ),
                (
                    "abandon_date",
                    models.DateField(
                        blank=True,
                        default=None,
                        help_text="The date this install was abandoned, unplugged, or disassembled",
                        null=True,
                    ),
                ),
                (
                    "unit",
                    models.CharField(
                        blank=True, default=None, help_text="Line 2 of this install's mailing address", null=True
                    ),
                ),
                (
                    "roof_access",
                    models.BooleanField(
                        default=False,
                        help_text="True if the member indicated they had access to the roof when they submitted the join form",
                    ),
                ),
                (
                    "referral",
                    models.TextField(
                        blank=True,
                        default=None,
                        help_text='The "How did you hear about us?" information provided to us when the member submitted the join form',
                        null=True,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        default=None,
                        help_text="A free-form text description of this Install, to track any additional information. For Installs imported from the spreadsheet, this starts with a formatted block of information about the import processand original spreadsheet data. However this structure can be changed by admins at any time and should not be relied onby automated systems. ",
                        null=True,
                    ),
                ),
                (
                    "diy",
                    models.BooleanField(
                        blank=True,
                        default=None,
                        help_text="Was this install conducted by the member themselves? If not, it was done by a volunteer installer on their behalf",
                        null=True,
                        verbose_name="Is DIY?",
                    ),
                ),
                (
                    "building",
                    models.ForeignKey(
                        help_text="The building where the install is located. In the case of a structure with multiple buildings, this will be the building whose address makes sense for this install's unit.",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="installs",
                        to="meshapi.building",
                    ),
                ),
                (
                    "member",
                    models.ForeignKey(
                        help_text="The member this install is associated with",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="installs",
                        to="meshapi.member",
                    ),
                ),
                (
                    "node",
                    models.ForeignKey(
                        blank=True,
                        help_text="The node this install is associated with, the integer value of this field is also the network number, which corresponds to the static IP address and OSPF ID of the router this install utilizes, the DHCP range it receives an address from, etc.",
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="installs",
                        to="meshapi.node",
                    ),
                ),
            ],
            options={
                "permissions": [("assign_nn", "Can assign an NN to install")],
            },
        ),
        migrations.AddField(
            model_name="device",
            name="node",
            field=models.ForeignKey(
                help_text="The logical node this Device is located within. The integer value of this field is also the network number, which corresponds to the static IP address and OSPF ID of this device or the DHCP range it receives an address from. This number is also usually found in the device name",
                on_delete=django.db.models.deletion.PROTECT,
                related_name="devices",
                to="meshapi.node",
            ),
        ),
        migrations.AddField(
            model_name="building",
            name="nodes",
            field=models.ManyToManyField(
                help_text="All nodes located on the same structure (i.e. a discrete man-made place identified by the same BIN) that this Building is located within.",
                related_name="buildings",
                to="meshapi.node",
            ),
        ),
        migrations.AddField(
            model_name="building",
            name="primary_node",
            field=models.ForeignKey(
                blank=True,
                help_text="The primary node for this Building, for cases where it has more than one. This is the node bearing the network number that the building is collquially referred to by volunteers and is usually the first NN held by any equipment on the building. If present, this must also be included in nodes",
                null=True,
                on_delete=django.db.models.deletion.PROTECT,
                related_name="+",
                to="meshapi.node",
            ),
        ),
    ]
